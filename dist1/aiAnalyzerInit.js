/*! For license information please see aiAnalyzerInit.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){t=function(){return n};var r,n={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(r){f=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof w?t:w,i=Object.create(o.prototype),c=new O(n||[]);return a(i,"_invoke",{value:N(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=h;var p="suspendedStart",g="suspendedYield",y="executing",v="completed",m={};function w(){}function b(){}function k(){}var x={};f(x,s,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(F([])));_&&_!==o&&i.call(_,s)&&(x=_);var E=k.prototype=w.prototype=Object.create(x);function z(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function S(t,r){function n(o,a,c,s){var l=d(t[o],t,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==e(f)&&i.call(f,"__await")?r.resolve(f.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):r.resolve(f).then((function(e){u.value=e,c(u)}),(function(e){return n("throw",e,c,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function N(e,t,n){var o=p;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=d(e,t,n);if("normal"===l.type){if(o=n.done?v:g,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function A(e,t){var n=t.method,o=e.iterator[n];if(o===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=r,A(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function F(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(i.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=k,a(E,"constructor",{value:k,configurable:!0}),a(k,"constructor",{value:b,configurable:!0}),b.displayName=f(k,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,f(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},n.awrap=function(e){return{__await:e}},z(S.prototype),f(S.prototype,l,(function(){return this})),n.AsyncIterator=S,n.async=function(e,t,r,o,i){void 0===i&&(i=Promise);var a=new S(h(e,t,r,o),i);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},z(E),f(E,u,"Generator"),f(E,s,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=F,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return c.type="throw",c.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:F(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),m}},n}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t,r,n,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function c(e){n(a,o,i,c,s,"next",e)}function s(e){n(a,o,i,c,s,"throw",e)}c(void 0)}))}}function i(e,t){return a.apply(this,arguments)}function a(){return a=o(t().mark((function e(r,n){var o,i,a,c,s,f,d,g=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>2&&void 0!==g[2]?g[2]:300,i=g.length>3&&void 0!==g[3]?g[3]:30,e.prev=2,e.next=5,h("fake_news_model/tokenizer.json");case 5:return a=e.sent,e.next=8,p("fake_news_model/source_encoder.json");case 8:return c=e.sent,s=(null==a?void 0:a.text_tokenizer)||a,f=l(r,s,o,2e4),d=u(n,c,i),e.abrupt("return",{textSequence:f.sequence,sourceSequence:d.sequence,debug:{text:f,source:d}});case 16:return e.prev=16,e.t0=e.catch(2),console.error("Error processing fake news input:",e.t0),e.abrupt("return",{textSequence:new Array(o).fill(0),sourceSequence:new Array(i).fill(0),error:e.t0.message});case 20:case"end":return e.stop()}}),e,null,[[2,16]])}))),a.apply(this,arguments)}function c(e){return s.apply(this,arguments)}function s(){return s=o(t().mark((function e(r){var n,o,i,a=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:30,e.prev=1,e.next=4,y("tfjs_clickbait_model/word_index.json","tfjs_clickbait_model/tokenizer_config.json");case 4:return o=e.sent,i=f(r,o,n),e.abrupt("return",{sequence:i.sequence,debug:i});case 9:return e.prev=9,e.t0=e.catch(1),console.error("Error processing clickbait input:",e.t0),e.abrupt("return",{sequence:new Array(n).fill(0),error:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),s.apply(this,arguments)}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e4,o=e;(t.config&&t.config.lowercase||t.config&&t.config.lower||t.lowercase)&&(o=o.toLowerCase());var i=t.config&&t.config.filters||t.filters;if(i){var a=new RegExp("[".concat(i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"]"),"g");o=o.replace(a," ")}var c=t.config&&t.config.split||t.split||" ",s=[];s=t.config&&t.config.char_level||t.char_level?o.split(""):o.split(c).filter((function(e){return e.length>0}));var l=t.word_index||{},u=t.oov_token_id||(t.config&&t.config.oov_token?l[t.config.oov_token]:1),f=Math.min(u,n-1),h=[],d=[];s.forEach((function(e){var t=l[e]||f;(t>=n||t<0)&&(console.warn('Token "'.concat(e,'" mapped to invalid ID ').concat(t,", using OOV token ID ").concat(f," instead")),t=f),h.push(t),d.push({token:e,id:t,isOOV:void 0===l[e],clamped:(l[e]||f)!==t})}));var p=[].concat(d);if(h.length>r)return{sequence:h.slice(0,r),tokenDebug:d.slice(0,r),originalDebug:p,truncated:!0};for(var g=t.pad_token_id||0;h.length<r;)h.push(g),d.push({token:"<PAD>",id:g,isPadding:!0});return{sequence:h,tokenDebug:d,originalDebug:p,truncated:!1,padded:h.length>p.length}}function u(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,n=(e||"").toLowerCase().trim(),o=(null==t?void 0:t.index)||{},i=o["<UNK>"]||0,a=o[n]||i,c=[a];c.length<r;)c.push(0);return{sequence:c,sourceId:a,originalSource:e,processedSource:n,isOOV:!o[n]}}function f(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=e.toLowerCase().split(/\s+/).filter((function(e){return e.length>0})),a=t.word_index||{},c=a[t.oov_token||"<UNK>"]||1,s=[],l=[],u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}(i);try{for(u.s();!(n=u.n()).done;){var f=n.value,h=a[f]||c;s.push(h),l.push({token:f,id:h,isOOV:void 0===a[f]})}}catch(e){u.e(e)}finally{u.f()}if(s.length>o)return{sequence:s.slice(0,o),tokenInfo:l.slice(0,o),truncated:!0};for(;s.length<o;)s.push(0),l.push({token:"<PAD>",id:0,isPadding:!0});return{sequence:s,tokenInfo:l,truncated:!1,padded:!0}}function h(e){return d.apply(this,arguments)}function d(){return(d=o(t().mark((function e(r){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(chrome.runtime.getURL("models/".concat(r)));case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Failed to load tokenizer: ".concat(n.status," ").concat(n.statusText));case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error loading tokenizer:",e.t0),e.abrupt("return",{word_index:{"<UNK>":1},config:{oov_token:"<UNK>"}});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=o(t().mark((function e(r){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(chrome.runtime.getURL("models/".concat(r)));case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Failed to load source encoder: ".concat(n.status," ").concat(n.statusText));case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error loading source encoder:",e.t0),e.abrupt("return",{index:{"<UNK>":0}});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function y(e,t){return v.apply(this,arguments)}function v(){return(v=o(t().mark((function e(r,n){var o,i,a,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(chrome.runtime.getURL("models/".concat(r)));case 3:if((o=e.sent).ok){e.next=6;break}throw new Error("Failed to load word index: ".concat(o.status));case 6:return e.next=8,o.json();case 8:return i=e.sent,a={oov_token:"<UNK>",max_len:30},e.prev=10,e.next=13,fetch(chrome.runtime.getURL("models/".concat(n)));case 13:if(!(c=e.sent).ok){e.next=18;break}return e.next=17,c.json();case 17:a=e.sent;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(10),console.warn("Could not load tokenizer config, using defaults");case 23:return e.abrupt("return",{word_index:i,oov_token:a.oov_token||"<UNK>",max_len:a.max_len||30,vocab_size:a.vocab_size||Object.keys(i).length+1});case 26:return e.prev=26,e.t1=e.catch(0),console.error("Error loading clickbait tokenizer:",e.t1),e.abrupt("return",{word_index:{"<UNK>":1},oov_token:"<UNK>",max_len:30,vocab_size:100});case 30:case"end":return e.stop()}}),e,null,[[0,26],[10,20]])})))).apply(this,arguments)}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function w(){w=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),c=new O(n||[]);return o(a,"_invoke",{value:N(e,r,c)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",d="suspendedYield",p="executing",g="completed",y={};function v(){}function b(){}function k(){}var x={};l(x,a,(function(){return this}));var L=Object.getPrototypeOf,_=L&&L(L(F([])));_&&_!==r&&n.call(_,a)&&(x=_);var E=k.prototype=v.prototype=Object.create(x);function z(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function r(o,i,a,c){var s=f(e[o],e,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==m(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function N(t,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?g:d,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=g,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function F(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(m(t)+" is not iterable")}return b.prototype=k,o(E,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:b,configurable:!0}),b.displayName=l(k,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,l(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},z(S.prototype),l(S.prototype,c,(function(){return this})),t.AsyncIterator=S,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new S(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},z(E),l(E,s,"Generator"),l(E,a,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=F,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:F(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function b(e,t,r,n,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){b(i,n,o,a,c,"next",e)}function c(e){b(i,n,o,a,c,"throw",e)}a(void 0)}))}}var x,L,_,E,z;window.aiAnalyzer={models:{},tokenizers:{},initialized:!1,_initializing:!1,waitForTensorFlow:(z=k(w().mark((function e(){var t,r=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:5e3,e.abrupt("return",new Promise((function(e){var r=Date.now(),n=function(){return window.tf?(console.log("TensorFlow.js is available"),void e(!0)):Date.now()-r>t?(console.error("Timed out waiting for TensorFlow.js after ".concat(t,"ms")),void e(!1)):(console.log("Waiting for TensorFlow.js..."),void setTimeout(n,100))};n()})));case 2:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)}),initialize:(E=k(w().mark((function e(){var t,r,n,o,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(this.initialized&&this.models.fakeNews&&this.models.clickbait)){e.next=4;break}return console.log("AI analyzer already initialized"),e.abrupt("return",!0);case 4:return console.log("Initializing AI analyzer with multiple models..."),e.next=7,this.waitForTensorFlow();case 7:if(e.sent){e.next=10;break}throw new Error("TensorFlow.js could not be loaded");case 10:if(this._initializing=!0,!window.initTfWasm){e.next=19;break}return e.next=14,window.initTfWasm();case 14:if(e.sent){e.next=17;break}throw new Error("Failed to initialize TensorFlow.js WASM backend");case 17:e.next=20;break;case 19:console.warn("TF WASM initialization function not found, using default backend");case 20:if(!window.tfConfig||window.tfConfig.initialized){e.next=23;break}return e.next=23,window.tfConfig.setup();case 23:return console.log("Loading tokenizers..."),e.next=26,h("fake_news_model/tokenizer.json");case 26:return this.tokenizers.fakeNewsText=e.sent,e.next=29,p("fake_news_model/source_encoder.json");case 29:return this.tokenizers.fakeNewsSource=e.sent,e.next=32,y("tfjs_clickbait_model/word_index.json","tfjs_clickbait_model/tokenizer_config.json");case 32:if(this.tokenizers.clickbait=e.sent,this.tokenizers.fakeNewsText&&this.tokenizers.fakeNewsSource&&this.tokenizers.clickbait){e.next=35;break}throw new Error("Failed to load one or more tokenizers");case 35:return console.log("Tokenizers loaded successfully"),console.log("Loading models..."),t=chrome.runtime.getURL("models/fake_news_model/model.json"),console.log("Loading Fake News model from:",t),e.next=41,tf.loadLayersModel(t);case 41:return this.models.fakeNews=e.sent,console.log("Fake News model loaded successfully"),r=chrome.runtime.getURL("models/tfjs_clickbait_model/model.json"),console.log("Loading Clickbait model from:",r),e.next=47,tf.loadLayersModel(r);case 47:this.models.clickbait=e.sent,console.log("Clickbait model loaded successfully");try{n=this.models.fakeNews.layers.find((function(e){return"text_embedding"===e.name})),this.fakeNewsTextVocabSize=n?n.getConfig().inputDim:2e4,o=this.models.fakeNews.layers.find((function(e){return"source_embedding"===e.name})),this.fakeNewsSourceVocabSize=o?o.getConfig().inputDim:2031,console.log("Fake News model configured with text vocab size: ".concat(this.fakeNewsTextVocabSize,", source vocab size: ").concat(this.fakeNewsSourceVocabSize)),i=this.models.clickbait.layers.find((function(e){return e.name.includes("embedding")})),this.clickbaitVocabSize=i?i.getConfig().inputDim:1e4,console.log("Clickbait model configured with vocab size: ".concat(this.clickbaitVocabSize))}catch(e){console.warn("Could not extract model configuration:",e)}return this.initialized=!0,this._initializing=!1,document.dispatchEvent(new CustomEvent("ai-analyzer-ready",{detail:{success:!0}})),console.log("AI analyzer fully initialized and ready for analysis"),e.abrupt("return",!0);case 57:return e.prev=57,e.t0=e.catch(0),console.error("Error initializing AI analyzer:",e.t0),this.initialized=!1,this._initializing=!1,document.dispatchEvent(new CustomEvent("ai-analyzer-ready",{detail:{success:!1,error:e.t0.message}})),e.abrupt("return",!1);case 64:case"end":return e.stop()}}),e,this,[[0,57]])}))),function(){return E.apply(this,arguments)}),isReady:(_=k(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("isReady called"),!(this.initialized&&this.models.fakeNews&&this.models.clickbait&&this.tokenizers.fakeNewsText&&this.tokenizers.fakeNewsSource&&this.tokenizers.clickbait)){e.next=4;break}return console.log("Already initialized, returning true"),e.abrupt("return",!0);case 4:if(!this._initializing){e.next=7;break}return console.log("Analyzer is initializing, waiting for completion..."),e.abrupt("return",new Promise((function(e){document.addEventListener("ai-analyzer-ready",(function(t){console.log("Received ai-analyzer-ready event",t.detail),e(t.detail.success)}),{once:!0})})));case 7:return console.log("Starting initialization"),e.next=10,this.initialize();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)}),analyzeText:(L=k(w().mark((function e(t){var r,n,o,a,s,l,u,f,h,d,p,g,y=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.error("ANALYZE TEXT CALLED",{textLength:t?t.length:0}),this.initialized&&this.models.fakeNews&&this.models.clickbait&&this.tokenizers.fakeNewsText&&this.tokenizers.fakeNewsSource&&this.tokenizers.clickbait){e.next=9;break}return console.warn("Models or tokenizers not initialized, initializing now..."),e.next=5,this.initialize();case 5:if(e.sent){e.next=9;break}return console.error("Failed to initialize, returning fallback results"),e.abrupt("return",{fakeNews:{label:"LABEL_0",score:.5},clickbait:{label:"LABEL_0",score:.5}});case 9:return r={label:"LABEL_1",score:.5},n={label:"LABEL_1",score:.5},e.prev=11,o=this.extractBaseDomain(window.location.href),console.error('ANALYZE TEXT - Processing "'.concat(t.substring(0,60),'..." from domain: ').concat(o)),console.error("RUNNING FAKE NEWS MODEL..."),e.prev=15,console.error("Step 1: Creating fake news inputs"),e.next=19,i(t,o,300,30);case 19:return a=e.sent,console.error("Step 2: Fake news model inputs created",{textLength:a.textSequence.length,sourceLength:a.sourceSequence.length}),console.error("Step 3: Creating tensors"),s=tf.tensor2d([a.textSequence],[1,a.textSequence.length]),l=tf.tensor2d([a.sourceSequence],[1,a.sourceSequence.length]),console.error("Tensors created successfully"),console.error("Step 4: Running model prediction"),e.next=28,tf.tidy((function(){if(!y.models.fakeNews||"function"!=typeof y.models.fakeNews.predict)throw new Error("Fake news model is not properly loaded or predict is not a function");console.error("Executing fake news model predict...");var e=y.models.fakeNews.predict([s,l]);return console.error("Prediction completed:",e),e.dataSync()}));case 28:u=e.sent,console.error("Step 5: Processing prediction results",Array.from(u)),f=u[0],r={label:f>.5?"LABEL_0":"LABEL_1",score:f>.5?f:1-f,rawProbability:f},console.error("Fake news result:",r),s.dispose(),l.dispose(),e.next=42;break;case 37:e.prev=37,e.t0=e.catch(15),console.error("CRITICAL ERROR with fake news model:",e.t0),console.error("Error details:",e.t0.message),console.error("Stack trace:",e.t0.stack);case 42:return e.prev=42,e.next=45,c(t,30);case 45:return h=e.sent,console.log("Clickbait Model Tokenization:",{text:t.substring(0,60)+"...",tokens:h.debug.tokenInfo.slice(0,10).map((function(e){return"".concat(e.token,"(").concat(e.id,")")})),truncated:h.debug.truncated,paddingAdded:h.debug.padded}),d=tf.tensor2d([h.sequence],[1,h.sequence.length]),p=this.models.clickbait.predict(d),e.next=51,p.data();case 51:g=e.sent,n={label:g[0]>.5?"LABEL_0":"LABEL_1",score:g[0]>.5?g[0]:1-g[0],rawProbability:g[0]},console.log("Clickbait Analysis - Label: ".concat(n.label,", Score: ").concat(n.score.toFixed(4),", Raw Probability: ").concat(g[0].toFixed(4))),d.dispose(),p.dispose(),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(42),console.error("Error with clickbait model:",e.t1);case 61:return console.error("Returning final analysis results"),e.abrupt("return",{fakeNews:r,clickbait:n});case 65:return e.prev=65,e.t2=e.catch(11),console.error("TOP-LEVEL Error in analyzeText:",e.t2),console.error("Stack trace:",e.t2.stack),e.abrupt("return",{fakeNews:{label:"LABEL_1",score:.5},clickbait:{label:"LABEL_1",score:.5}});case 70:case"end":return e.stop()}}),e,this,[[11,65],[15,37],[42,58]])}))),function(e){return L.apply(this,arguments)}),extractBaseDomain:function(e){try{var t=new URL(e).hostname,r=t.split(".");return r.length>2?("co"===r[r.length-2]||"com"===r[r.length-2]||"net"===r[r.length-2]||"org"===r[r.length-2])&&r.length>3?r[r.length-3]:r[r.length-2]:2===r.length?r[0]:t}catch(e){return console.error("Error extracting domain:",e),""}},analyzeTextArray:(x=k(w().mark((function e(t){var r,n,o,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialized&&this.models.fakeNews&&this.models.clickbait){e.next=7;break}return e.next=4,this.initialize();case 4:if(e.sent){e.next=7;break}return e.abrupt("return",{predictions:t.map((function(){return{fakeNews:{label:"LABEL_0",score:.5},clickbait:{label:"LABEL_0",score:.5}}}))});case 7:return console.log("Processing ".concat(t.length," texts with both fake news and clickbait models")),e.next=10,Promise.all(t.map(function(){var e=k(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.analyzeText(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:return r=e.sent,n=r.filter((function(e){return"LABEL_0"===e.fakeNews.label})).length,o=r.filter((function(e){return"LABEL_0"===e.clickbait.label})).length,console.log("Analysis complete. Fake News positives: ".concat(n,", Clickbait positives: ").concat(o)),e.abrupt("return",{predictions:r});case 17:return e.prev=17,e.t0=e.catch(0),console.error("Error analyzing text array:",e.t0),e.abrupt("return",{predictions:t.map((function(){return{fakeNews:{label:"LABEL_0",score:.5},clickbait:{label:"LABEL_0",score:.5}}}))});case 21:case"end":return e.stop()}}),e,this,[[0,17]])}))),function(e){return x.apply(this,arguments)})},console.log("AI Analyzer object initialized and available as window.aiAnalyzer"),console.log("isReady function available:","function"==typeof window.aiAnalyzer.isReady),window.tf&&window.aiAnalyzer.initialize().then((function(e){console.log("Initial AI analyzer initialization ".concat(e?"succeeded":"failed"))}))})();