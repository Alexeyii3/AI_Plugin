document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("highlightToggle"),e=document.getElementById("currentSite"),n=document.getElementById("siteBadge"),s=document.getElementById("totalAnalyzed"),o=document.getElementById("highlightCount"),r=document.getElementById("addSiteBtn"),i=document.getElementById("customSitesList"),c=document.getElementById("emptySitesMessage"),a="",l="",u=!0;function d(t){return t&&!t.startsWith("chrome://")&&!t.startsWith("chrome-extension://")&&!t.startsWith("chrome-search://")&&!t.startsWith("about:")&&!t.startsWith("edge://")&&!t.startsWith("brave://")&&!t.startsWith("devtools://")}function m(t){if(!t)return"";var e=t;e.startsWith("www.")&&(e=e.slice(4));var n=e.split(".");return n.length>=2?n.length>2&&("co"===n[n.length-2]||"com"===n[n.length-2])?n[n.length-3]:n[0]:e}function g(){chrome.storage.sync.get(["customNewsSites"],(function(t){var e=t.customNewsSites||[];e.length>0?(c.style.display="none",i.innerHTML="",e.forEach((function(t){var e=document.createElement("li");e.className="site-item",e.innerHTML="\n                        <span>".concat(t,'</span>\n                        <button class="delete-site" data-site="').concat(t,'">&times;</button>\n                    '),i.appendChild(e)})),document.querySelectorAll(".delete-site").forEach((function(t){t.addEventListener("click",(function(){var t;t=this.getAttribute("data-site"),chrome.storage.sync.get(["customNewsSites"],(function(e){var s=e.customNewsSites||[];s=s.filter((function(e){return e!==t})),chrome.storage.sync.set({customNewsSites:s},(function(){g(),f("Removed ".concat(t," from news sites"),"success"),t===l&&(n.textContent="Non-News Site",n.classList.remove("news"),n.classList.add("non-news")),h(t,!1)}))}))}))}))):(c.style.display="block",i.innerHTML="")}))}function h(t,e){chrome.tabs.query({},(function(n){n.forEach((function(n){if(d(n.url))try{m(new URL(n.url).hostname)===t&&chrome.tabs.sendMessage(n.id,{action:"siteStatusChanged",isNewsSite:e,shouldRemoveHighlights:!e},(function(t){chrome.runtime.lastError&&console.log("Error sending status update to tab:",chrome.runtime.lastError.message)}))}catch(t){console.log("Error processing tab URL:",t)}}))}))}function f(t,e){var n=document.querySelector(".message");n&&n.remove();var s=document.createElement("div");s.className="message ".concat(e),s.textContent=t;var o=document.querySelector(".custom-sites");o.parentNode.insertBefore(s,o.nextSibling),setTimeout((function(){s.classList.add("fade")}),2e3)}chrome.storage.local.get(["highlightingEnabled"],(function(e){var n=!1!==e.highlightingEnabled;t.checked=n})),t.addEventListener("change",(function(){var e=t.checked;chrome.storage.local.set({highlightingEnabled:e}),u&&chrome.tabs.query({active:!0,currentWindow:!0},(function(t){t.length>0&&d(t[0].url)&&chrome.tabs.sendMessage(t[0].id,{highlightingEnabled:e},(function(t){chrome.runtime.lastError&&console.log("Error sending message:",chrome.runtime.lastError.message)}))}));var n=document.createElement("span");n.classList.add("toggle-ripple"),document.querySelector(".toggle").appendChild(n),setTimeout((function(){return n.remove()}),500)})),r.addEventListener("click",(function(){l&&chrome.storage.sync.get(["customNewsSites"],(function(t){var e=t.customNewsSites||[];e.includes(l)?f("This site is already in your list","error"):(e.push(l),chrome.storage.sync.set({customNewsSites:e},(function(){g(),f("Added ".concat(l," to news sites"),"success"),n.textContent="News Site",n.classList.remove("non-news"),n.classList.add("news"),h(l,!0)})))}))})),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){if(0===t.length)return e.textContent="Unknown site",n.textContent="Unknown",void(u=!1);var r=t[0];if(!d(r.url))return e.textContent="System page",n.textContent="Not applicable",n.classList.add("non-news"),void(u=!1);try{var i=new URL(r.url);a=i.hostname,l=m(a),e.textContent=a,chrome.runtime.sendMessage({action:"checkNewsSite",domain:l},(function(t){t&&t.isNewsSite?(n.textContent="News Site",n.classList.add("news")):(n.textContent="Non-News Site",n.classList.add("non-news"))})),u?chrome.tabs.sendMessage(r.id,{action:"getStats"},(function(t){if(chrome.runtime.lastError)return console.log("Error getting stats:",chrome.runtime.lastError.message),s.textContent="N/A",void(o.textContent="N/A");t&&(s.textContent=t.totalAnalyzed||0,o.textContent=t.highlightCount||0,s.classList.add("count-animation"),o.classList.add("count-animation"))})):(s.textContent="N/A",o.textContent="N/A")}catch(t){console.error("Error processing tab URL:",t),e.textContent="Error",n.textContent="Unknown",u=!1}})),g()}));